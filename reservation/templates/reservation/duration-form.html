{% load static %}
{% with ctx=row|default:item %}

<form method="post" action="{% url 'reservation:adjust_bag' ctx.item_id %}" class="bag-row"
  id="bag-row-{{ ctx.item_id }}" data-price="{{ ctx.product.price }}"
  data-deposit="{{ ctx.product.deposit|default:0 }}">
  {% csrf_token %}
  <input type="hidden" name="redirect_url" value="{% url 'reservation:view_bag' %}">

  <!-- Start Date Picker -->
  <div class="mb-3">
    <label class="form-label">Start Date:</label>
    <div class="input-group" id="start-date-picker-{{ ctx.item_id }}" data-td-target-input="nearest"
      data-td-target-toggle="nearest">
      <input id="start-date-{{ ctx.item_id }}" name="start_date" type="text" class="form-control"
        data-td-target="#start-date-picker-{{ ctx.item_id }}" autocomplete="off"
        value="{{ ctx.start_date }}" />
      <span class="input-group-text" data-td-target="#start-date-picker-{{ ctx.item_id }}"
        data-td-toggle="datetimepicker">
        <i class="fa fa-calendar"></i>
      </span>
    </div>
  </div>

  <!-- End Date Picker -->
  <div class="mb-3">
    <label class="form-label">End Date:</label>
    <div class="input-group" id="end-date-picker-{{ ctx.item_id }}" data-td-target-input="nearest"
      data-td-target-toggle="nearest">
      <input id="end-date-{{ ctx.item_id }}" name="end_date" type="text" class="form-control"
        data-td-target="#end-date-picker-{{ ctx.item_id }}" autocomplete="off"
        value="{{ ctx.end_date }}" />
      <span class="input-group-text" data-td-target="#end-date-picker-{{ ctx.item_id }}"
        data-td-toggle="datetimepicker">
        <i class="fa fa-calendar"></i>
      </span>
    </div>
  </div>

  <button class="btn btn-outline-warning" type="submit">
    <i class="fas fa-chevron-up"></i> Update
  </button>

  <button id="remove_{{ ctx.item_id }}" class="btn btn-outline-danger remove-item" type="button">
    Remove <i class="fas fa-trash-alt"></i>
  </button>

</form>

{% endwith %}

{% block onload_js %}
<script src="{% static 'js/card_index.js' %}"></script>
<script src="{% static 'js/price_calculator.js' %}"></script>
<script src="{% static 'js/item_removal.js' %}"></script>
<script>document.addEventListener("DOMContentLoaded", function () {
  // Loop over all previous pickers
  document.querySelectorAll('[id^="start-date-picker-"]').forEach(picker => {
    new tempusDominus.TempusDominus(picker);
  });

  document.querySelectorAll('[id^="end-date-picker-"]').forEach(picker => {
    new tempusDominus.TempusDominus(picker);
  });
});</script>
{% endblock %}
