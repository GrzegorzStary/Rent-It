{% extends "account/base.html" %}
{% load static %}
{% load i18n %}
{% load allauth account %}
{% load widget_tweaks %}

{% block head_title %}
    {% translate "Phone Verification" %}
{% endblock head_title %}

{% block content %}
<div class="container">
    <div class="row justify-content-center mt-5 mb-5">
        <div class="col-lg-6 col-md-8 col-sm-12 p-5 shadow-sm rounded-0 signup-card">

            <h1 class="fw-bold mb-3 text-center fs-1 signup-title">
                {% translate "Enter Phone Verification Code" %}
            </h1>

            <p class="text-center mb-4 fs-6 signup-subtext">
                {% blocktranslate %}
                    We've sent a code to 
                    <a href="tel:{{ phone }}">{{ phone }}</a>. 
                    The code expires shortly, so please enter it soon.
                {% endblocktranslate %}
            </p>

            {% url 'account_verify_phone' as action_url %}
            {% element form form=verify_form method="post" action=action_url tags="entrance,phone,verification" %}
                {% slot body %}
                    {% csrf_token %}
                    {% for field in verify_form %}
                    <div class="mb-4">
                        <label for="{{ field.id_for_label }}" class="form-label fw-semibold text-dark">
                            {{ field.label }}
                        </label>
                        {{ field|add_class:"form-control form-control-lg rounded-0" }}
                        {% if field.errors %}
                        <div class="text-danger small mt-1">
                            {{ field.errors }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    {{ redirect_field }}
                {% endslot %}

                {% slot actions %}
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                        {% translate "Confirm" %}
                    </button>
                    {% if can_resend %}
                    <button form="resend" class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                        {% translate "Request new code" %}
                    </button>
                    {% endif %}
                    {% if cancel_url %}
                    <a href="{{ cancel_url }}" class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                        {% translate "Cancel" %}
                    </a>
                    {% else %}
                    <button type="submit" form="logout-from-stage" class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                        {% translate "Cancel" %}
                    </button>
                    {% endif %}
                </div>
                {% endslot %}
            {% endelement %}

            <form id="resend" method="post" action="{{ action_url }}">
                <input type="hidden" name="action" value="resend">
                {% csrf_token %}
            </form>

            {% if not cancel_url %}
            <form id="logout-from-stage" method="post" action="{% url 'account_logout' %}">
                <input type="hidden" name="next" value="{% url 'account_login' %}">
                {% csrf_token %}
            </form>
            {% endif %}

            {% if can_change %}
            <details class="mt-4">
                <summary class="fw-bold">{% translate "Use a different phone number" %}</summary>
                <div class="mt-3">
                    {% element form form=change_form method="post" action=action_url %}
                        {% slot body %}
                            {% csrf_token %}
                            {% for field in change_form %}
                            <div class="mb-4">
                                {{ field|add_class:"form-control form-control-lg rounded-0" }}
                                {% if field.errors %}
                                <div class="text-danger small mt-1">
                                    {{ field.errors }}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% endslot %}
                        {% slot actions %}
                        <div class="d-grid">
                            <button type="submit" name="action" value="change" class="btn btn-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                                {% translate "Change" %}
                            </button>
                        </div>
                        {% endslot %}
                    {% endelement %}
                </div>
            </details>
            {% endif %}

        </div>
    </div>
</div>
{% endblock content %}
