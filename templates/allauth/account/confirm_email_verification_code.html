{% extends "account/base.html" %}
{% load static %}
{% load i18n %}
{% load allauth account %}
{% load widget_tweaks %}

{% block head_title %}
{% translate "Email Verification" %}
{% endblock head_title %}

{% block content %}
<div class="container">
    <div class="row justify-content-center mt-5 mb-5">
        <div class="col-lg-6 col-md-8 col-sm-12 p-5 shadow-sm rounded-0 signup-card">

            <h1 class="fw-bold mb-3 text-center fs-1 signup-title">
                {% translate "Enter Email Verification Code" %}
            </h1>

            <p class="text-center mb-4 fs-6 signup-subtext">
                {% blocktranslate %}We've sent a code to <a href="mailto:{{ email }}">{{ email }}</a>.
                The code expires shortly, so please enter it soon.{% endblocktranslate %}
            </p>

            {% url 'account_email_verification_sent' as action_url %}
            {% element form form=verify_form method="post" action=action_url tags="entrance,email,verification" %}
            {% slot body %}
            {% csrf_token %}
            {% for field in verify_form %}
            <div class="mb-4">
                <label for="{{ field.id_for_label }}" class="form-label fw-semibold text-dark">
                    {{ field.label }}
                </label>
                {{ field|add_class:"form-control form-control-lg rounded-0" }}
                {% if field.errors %}
                <div class="text-danger small mt-1">
                    {{ field.errors }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
            {{ redirect_field }}
            {% endslot %}

            {% slot actions %}
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                    {% translate "Confirm" %}
                </button>
                {% if can_resend %}
                <button form="resend" class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                    {% translate "Request new code" %}
                </button>
                {% endif %}
                {% if cancel_url %}
                <a href="{{ cancel_url }}" class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                    {% translate "Cancel" %}
                </a>
                {% else %}
                <button type="submit" form="logout-from-stage"
                    class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                    {% translate "Cancel" %}
                </button>
                {% endif %}
            </div>
            {% endslot %}
            {% endelement %}

            <form id="resend" method="post" action="{{ action_url }}">
                <input type="hidden" name="action" value="resend">
                {% csrf_token %}
            </form>

            {% if not cancel_url %}
            <form id="logout-from-stage" method="post" action="{% url 'account_logout' %}">
                <input type="hidden" name="next" value="{% url 'account_login' %}">
                {% csrf_token %}
            </form>
            {% endif %}

            {% if can_change %}
            <hr class="my-4">
            <details {% if change_form.errors %}open{% endif %}>
                <summary class="fw-bold mb-3">{% translate "Use a different email address" %}</summary>
                <form method="post" action="{{ action_url }}">
                    {% csrf_token %}
                    {% for field in change_form %}
                    <div class="mb-3">
                        <label for="{{ field.id_for_label }}" class="form-label text-dark fw-semibold">
                            {{ field.label }}
                        </label>
                        {{ field|add_class:"form-control form-control-lg rounded-0" }}
                        {% if field.errors %}
                        <div class="text-danger small mt-1">
                            {{ field.errors }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    <div class="d-grid">
                        <button type="submit" name="action" value="change"
                            class="btn btn-outline-primary btn-lg text-uppercase fw-bold py-2 rounded-0">
                            {% translate "Change" %}
                        </button>
                    </div>
                </form>
            </details>
            {% endif %}

        </div>
    </div>
</div>
{% endblock content %}